rule indel_realigner:
    input:
        bam = indel_realigner_input,
        ref = cfg.PROJECT + "/references/%s.fa" % cfg.PROJECT ,
        ref_dict = cfg.PROJECT + "/references/%s.dict" % cfg.PROJECT 
    output:
        bam = cfg.PROJECT  + "/indel_realigner/%s.bam" % cfg.PROJECT,
        intervals = cfg.PROJECT + "/indel_realigner/%s.intervals" % cfg.PROJECT
    log:
        out = cfg.PROJECT + "/logs/gatk/IndelRealigner/stdout.logs",
        err = cfg.PROJECT + "/logs/gatk/IndelRealigner/stderr.logs"
    params:
        gatk = config["gatk_bin"]
    shell:
        """
        samtools index {input.bam}

        {params.gatk} -T RealignerTargetCreator -R {input.ref} \
        -I {input.bam} -o {output.intervals} > {log.out} 2> {log.err}

        {params.gatk} -T IndelRealigner -R {input.ref} -I {input.bam} \
        -targetIntervals {output.intervals} -o {output.bam} >> {log.out} \
        2>> {log.err}
        """
