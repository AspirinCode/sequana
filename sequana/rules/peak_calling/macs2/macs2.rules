rule macs2:
    """
    macs2 peak caller https://github.com/taoliu/MACS. Main MACS2 Function to Call peaks from alignment results.


    Required input:
        __macs2__input_treatment: ChIP-seq treatment file. If multiple files are given
                        as '-t A B C', then they will all be read and pooled
                        together.
        __macs2__input_control: Control file. If multiple files are given as '-c A B
                        C', they will be pooled to estimate ChIP-seq
                        background noise.

    Required output:
        __macs2__output: peak file
    """

    input:
        bam = __macs2__input_treatment,
        ctl = __macs2__input_control
    params:
        gsize = config["macs2"]["genomeSize"],
        readLength = config["macs2"]["readLength"],
        qval = config["macs2"]["qval"],
        options = config["macs2"]['options'],
        prefix =  __macs2__output
    log:
        __macs2__log
    output:
        touch(__macs2__output_done)
    threads: 1
    run:
        if input.ctl == "None":
            shell(""" macs2 callpeak -t {input.bam}  -f BAM -g {params.gsize} -n {params.prefix}
                    --extsize={params.readLength} -q {params.pval} {params.options} 2> {log}""")
        else:
            shell(""" macs2 callpeak -t {input.bam} -c {input.ctl}  -f BAM -g {params.gsize} -n {params.prefix}
                     --extsize={params.readLength} -q {params.pval} {params.options} 2> {log}""")
