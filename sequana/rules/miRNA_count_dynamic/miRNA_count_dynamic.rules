def miRNA_count_dynamic(name, log_dir):

    metadata = {"name": name, "log_dir": log_dir}

    """
    miRNA_count ....

    Required input:
        __miRNA_count__input: bam file

    Required output:
        __miRNA_count__output: tabulated file
    """

    miRNA_count_code = '''
rule miRNA_count_%(name)s:
    input:
        __miRNA_count_%(name)s__input
    output:
        __miRNA_count_%(name)s__output
    log:
        __miRNA_count_%(name)s__log
    run:
        shell("""samtools view {input} | gawk -v FS='\t' '!/^@/{print $3}' | sort | uniq -c | gawk '{print $2 '\t' $1 }'  > {output}""")
    '''

    from easydev import TempFile
    tt = TempFile()
    with open(tt.name, "w") as fh:
        fh.write(miRNA_count_code % metadata)
    return fh.name
