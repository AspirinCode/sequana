
rule plotCoverage:
    """
    This tool is useful to assess the sequencing depth of a given sample. It samples 1 million bp, counts the number
    of overlapping reads and can report a histogram that tells you how many bases are covered how many times.
    Multiple BAM files are accepted, but they all should correspond to the same genome assembly.

    Is part of deeptools http://deeptools.readthedocs.io/en/latest/index.html

    Required input:
        __plotCoverage__input: list of bam files

    Required output:
        __plotCoverage__output: png file
    """
    input:
        __plotCoverage__input
    log:
        __plotCoverage__log
    output:
        tab = __plotCoverage__output_tab,
        file = __plotCoverage__output_file
    threads: 4
    run:
        labels = " ".join(str(os.path.basename(label).split("_")[0]) for label in input.bam)
        shell("plotCoverage --bamfiles {input.bam} --plotFile {output.file} -p 4 --labels " + labels + "--ignoreDuplicates --outRawCounts {output.tab} 2> {log}")
