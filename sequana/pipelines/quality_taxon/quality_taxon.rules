import sequana
from sequana import snaketools as sm
from sequana.snaketools import SequanaConfig, FileFactory
sm.init("quality_taxon.rules", globals())



# Connect the sub-pipelines together
include: sm.modules['quality']


# Connect the kraken_contaminant pipeline to the quality pipeline at the output
# of the cutapdat rule
if config['kraken']['do']:
    config["kraken_input"] = "cutadapt"
    include: sm.modules['kraken']
    expected_output.append(__kraken__output)


expected_output.append("logs/pipeline_quality.done")


rule pipeline_quality_taxon:
    input:
        expected_output
    output:
        touch("logs/pipeline_quality_taxon.done")

onsuccess:
    shell("cp %s %s/" % (__snakefile__, "report"))
    shell("cp config.yaml %s/" % "report")
    sm.plot_stats()
    from sequana.report_summary import SequanaSummary
    ss = SequanaSummary("report", "summary.html", snakefile=__snakefile__)
    ss.create_report()

